<body>
  <!-- Sidenav -->
  <% include ../partials/sidebar %>
  <!-- Main content -->
  <div class="main-content">
    <!-- Top navbar -->
    <% include ../partials/navbar %>
    <!-- Header -->
    <% include ../partials/header %>
    <!-- Page content -->
    <div class="container-fluid mt--5">
      <div class="row">
        <div class="col-xl-12 order-xl-1">
          <div class="card bg-secondary shadow">
            <div class="card-header bg-white border-0">
              <div class="row align-items-center">
                <div class="col-8">
                  <h3 class="mb-0">Update Blog</h3>
                </div>
                <div class="col-4 text-right">
                  <a href="/" class="btn btn-sm btn-primary">Back</a>
                </div>
              </div>
            </div>
            <div class="card-body">
              <form id="blogForm">
                <h6 class="heading-small text-muted mb-4">Blog information</h6>
                <div class="pl-lg-4">
                  <% if (locals.messages && messages.success) { %>
                  <div
                    class="alert alert-success alert-dismissible fade show"
                    role="alert"
                  >
                    <%= messages.success %>
                    <button
                      type="button"
                      class="close"
                      data-dismiss="alert"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">×</span>
                    </button>
                  </div>
                  <% } %> <% if (locals.messages && messages.errors &&
                  messages.errors.databaseError) { %>
                  <div
                    class="alert alert-danger alert-dismissible fade show"
                    role="alert"
                  >
                    <%= messages.errors %>
                    <button
                      type="button"
                      class="close"
                      data-dismiss="alert"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">×</span>
                    </button>
                  </div>
                  <% } %>
                  <div class="row">
                    <div class="col-lg-8">
                      <div class="form-group">
                        <label class="form-control-label" for="input-name"
                          >Title</label
                        >
                        <input
                          type="text"
                          id="input-title"
                          class="form-control form-control-alternative"
                          name="title"
                          placeholder="Title"
                          value="<%= locals.userInfo && locals.userInfo.name %>"
                        />
                        <% if (locals.messages && messages.errors &&
                        messages.errors.name) { %>
                        <strong class="invalid-feedback" style="display: block"
                          ><%= messages.errors.name %></strong
                        >
                        <% } %>
                      </div>
                    </div>
                    <div class="col-lg-4">
                      <div class="form-group">
                        <label class="form-control-label" for="input-slug"
                          >Slug</label
                        >
                        <input
                          type="text"
                          id="input-slug"
                          class="form-control form-control-alternative"
                          name="slug"
                          placeholder="s-l-u-g"
                          value=""
                        />
                        <% if (locals.messages && messages.errors &&
                        messages.errors.name) { %>
                        <strong class="invalid-feedback" style="display: block"
                          ><%= messages.errors.name %></strong
                        >
                        <% } %>
                      </div>
                    </div>
                    <div class="col-lg-12">
                      <div class="form-group">
                        <label
                          class="form-control-label"
                          for="input-description"
                          >Description</label
                        >
                        <textarea
                          type="text"
                          id="input-description"
                          class="form-control form-control-alternative"
                          rows="2"
                          name="description"
                          placeholder="Write about blog..."
                          value="<%= locals.userInfo && locals.userInfo.email %>"
                        ></textarea>
                        <% if (locals.messages && messages.errors &&
                        messages.errors.username) { %>
                        <strong class="invalid-feedback" style="display: block"
                          ><%= messages.errors.username %></strong
                        >
                        <% } %>
                      </div>
                    </div>
                    <div class="col-lg-2">
                      <div class="form-group">
                        <label class="form-control-label" for="input-date"
                          >Date</label
                        >
                        <input
                          type="date"
                          id="input-date"
                          class="form-control form-control-alternative"
                          name="date"
                          value="<%= locals.userInfo && locals.userInfo.name %>"
                        />
                        <% if (locals.messages && messages.errors &&
                        messages.errors.name) { %>
                        <strong class="invalid-feedback" style="display: block"
                          ><%= messages.errors.name %></strong
                        >
                        <% } %>
                      </div>
                    </div>
                    <div class="col-lg-4">
                      <div class="form-group">
                        <label class="form-control-label" for="input-category"
                          >Category</label
                        >
                        <select
                          class="form-control form-control-alternative"
                          aria-label=".form-select-sm example"
                          id="input-category"
                          name="category"
                        >
                          <option selected>Choose one</option>
                          <option value="Health and fitness">
                            Health and fitness
                          </option>
                          <option value="Lifestyle">Lifestyle</option>
                          <option value="Travely">Travel</option>
                          <option value="Parenting">Parenting</option>
                          <option value="Business">Business</option>
                          <option value="Personal finance">
                            Personal finance
                          </option>
                          <option value="Sports">Sports</option>
                        </select>
                        <% if (locals.messages && messages.errors &&
                        messages.errors.name) { %>
                        <strong class="invalid-feedback" style="display: block"
                          ><%= messages.errors.name %></strong
                        >
                        <% } %>
                      </div>
                    </div>
                    <div class="col-lg-6">
                      <div class="form-group">
                        <label class="form-control-label" for="input-tumbnail"
                          >Thumbnail</label
                        >
                        <input
                          type="file"
                          class="form-control form-control-alternative form-control"
                          id="input-thumbnail"
                          name="imageThumbnail"
                        />
                        <% if (locals.messages && messages.errors &&
                        messages.errors.name) { %>
                        <strong class="invalid-feedback" style="display: block"
                          ><%= messages.errors.name %></strong
                        >
                        <% } %>
                      </div>
                    </div>
                    <div class="col-lg-12">
                      <div class="form-group">
                        <label class="form-control-label" for="input-images"
                          >Images</label
                        >
                        <input
                          type="file"
                          class="form-control form-control-alternative form-control"
                          id="input-images"
                          name="images"
                          multiple
                        />
                        <% if (locals.messages && messages.errors &&
                        messages.errors.name) { %>
                        <strong class="invalid-feedback" style="display: block"
                          ><%= messages.errors.name %></strong
                        >
                        <% } %>
                      </div>
                    </div>
                    <div class="col-lg-6 text-center">
                      <button type="submit" class="btn btn-success mt-4 mb-4">
                        Save
                      </button>
                    </div>
                    <div class="col-lg-6 text-center">
                      <a href="/" class="btn btn-danger mt-4 mb-4">Cancel</a>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- Footer -->
      <% include ../partials/footer %>
    </div>
  </div>

  <!-- Include scripts -->
  <% include ../partials/scripts %>
  <script>
    console.log("here");
    const title = document.querySelector('#input-title');
    const slug = document.getElementById("input-slug");

    title.addEventListener('change',(e)=>{
      slug.value = (title.value).trim().toLowerCase().replaceAll(' ','-');
    })

    const blogForm = document.getElementById("blogForm");
    blogForm.addEventListener("submit", (e) => {
      e.preventDefault();

      const title = document.getElementById("input-title").value;
      const slug = document.getElementById("input-slug").value;
      const description = document.getElementById("input-description").value;
      const date = document.getElementById("input-date").value;
      const category = document.getElementById("input-category").value;
      const thumbnail = document.getElementById("input-thumbnail").files;
      const images = document.getElementById("input-images").files;

      const muBody = {
        title,
        slug : title.toLowerCase().replaceAll(' ','-'),
        description,
        date,
        category,
        thumbnail,
        images,
      };

      const userAction = async () => {
        const response = await fetch(`http://localhost:3000/blog`, {
          method: "POST",
          body: JSON.stringify(myBody),
          headers: {
            "Content-Type": "application/json",
          },
        });

        if (response.status === 200) {
          window.location.href = `http://localhost:3000/`;
        } else {
          window.location.href = `http://localhost:3000/blog/`;
        }
      };
    });
  </script>
</body>
